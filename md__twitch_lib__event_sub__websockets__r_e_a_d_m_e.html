<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TwitchLib: TwitchLib.EventSub.Websockets</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">TwitchLib<span id="projectnumber">&#160;3.5.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__twitch_lib__event_sub__websockets__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets.html">TwitchLib.EventSub.Websockets</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="el" href="namespace_twitch_lib.html">TwitchLib</a> component to connect to Twitch's EventSub service via Websockets also known as EventSockets</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Disclaimer</h1>
<p >EventSub via Websockets is still in open beta. You can use it in production but Twitch may introduce breaking changes without prior notice. The same goes for this implementation until it reaches Version 1.0.0</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Prerequisites</h1>
<ul>
<li>Currently we only support setup via Dependency Injection</li>
</ul>
<h1><a class="anchor" id="autotoc_md30"></a>
Resources</h1>
<p >If you need help on how to setup Dependency Injection in your Console or WPF Application you can have a look at these guides:</p><ul>
<li>Console: <a href="https://dfederm.com/building-a-console-app-with-.net-generic-host/">https://dfederm.com/building-a-console-app-with-.net-generic-host/</a></li>
<li>WPF: <a href="https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/">https://laurentkempe.com/2019/09/03/WPF-and-dotnet-Generic-Host-with-dotnet-Core-3-0/</a></li>
</ul>
<p >You can also find a console app example for .NET 6 and for .NET Framework 4.8 in the repo.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Installation</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">NuGet   </th><th class="markdownTableHeadRight"></th><th class="markdownTableHeadLeft"><a href="https://www.nuget.org/packages/TwitchLib.EventSub.Websockets"><img src="https://img.shields.io/nuget/v/TwitchLib.EventSub.Websockets.svg?label=TwitchLib.EventSub.Websockets" alt="TwitchLib.EventSub.Websockets" style="pointer-events: none;" class="inline"/></a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Package Manager   </td><td class="markdownTableBodyRight"><code>PM&gt;</code>   </td><td class="markdownTableBodyLeft"><code>Install-Package <a class="el" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets.html">TwitchLib.EventSub.Websockets</a> -Version 0.3.0</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">.NET CLI   </td><td class="markdownTableBodyRight"><code>&gt;</code>   </td><td class="markdownTableBodyLeft"><code>dotnet add package <a class="el" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets.html">TwitchLib.EventSub.Websockets</a> --version 0.3.0</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PackageReference   </td><td class="markdownTableBodyRight"></td><td class="markdownTableBodyLeft"><code>&lt;PackageReference Include="TwitchLib.EventSub.Websockets" Version="0.3.0" /&gt;</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Paket CLI   </td><td class="markdownTableBodyRight"><code>&gt;</code>   </td><td class="markdownTableBodyLeft"><code>paket add <a class="el" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets.html">TwitchLib.EventSub.Websockets</a> --version 0.3.0</code>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md32"></a>
Setup</h1>
<p >Step 1: Create a new project (Console, WPF, ASP.NET)</p>
<p >Step 2: Install the <a class="el" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets.html">TwitchLib.EventSub.Websockets</a> nuget package. (See above on how to do that)</p>
<p >Step 3: Step 3: Add necessary services and config to the DI Container</p>
<div class="fragment"><div class="line">services.AddTwitchLibEventSubWebsockets();</div>
<div class="line">services.AddHostedService&lt;WebsocketHostedService&gt;();</div>
</div><!-- fragment --><p> (The location of where to put this and the naming of variables might differ depending on what kind of project and general setup you have)</p>
<p >Step 4: Create the HostedService we just added to the DI container and connect to EventSub and listen to Events</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>System.Net.Http.Headers;</div>
<div class="line"><span class="keyword">using </span>System.Text;</div>
<div class="line"><span class="keyword">using </span>System.Text.Json;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args.html">TwitchLib.EventSub.Websockets.Core.EventArgs</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_channel.html">TwitchLib.EventSub.Websockets.Core.EventArgs.Channel</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>TwitchLib.EventSub.Websockets.Test</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>WebsocketHostedService : IHostedService</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">private</span> readonly ILogger&lt;WebsocketHostedService&gt; _logger;</div>
<div class="line">        <span class="keyword">private</span> readonly <a class="code hl_class" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_event_sub_websocket_client.html">EventSubWebsocketClient</a> _eventSubWebsocketClient;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> WebsocketHostedService(ILogger&lt;WebsocketHostedService&gt; logger, <a class="code hl_class" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_event_sub_websocket_client.html">EventSubWebsocketClient</a> eventSubWebsocketClient)</div>
<div class="line">        {</div>
<div class="line">            _logger = logger ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(logger));</div>
<div class="line"> </div>
<div class="line">            _eventSubWebsocketClient = eventSubWebsocketClient ?? <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(nameof(eventSubWebsocketClient));</div>
<div class="line">            _eventSubWebsocketClient.WebsocketConnected += OnWebsocketConnected;</div>
<div class="line">            _eventSubWebsocketClient.WebsocketDisconnected += OnWebsocketDisconnected;</div>
<div class="line">            _eventSubWebsocketClient.WebsocketReconnected += OnWebsocketReconnected;</div>
<div class="line">            _eventSubWebsocketClient.ErrorOccurred += OnErrorOccurred;</div>
<div class="line"> </div>
<div class="line">            _eventSubWebsocketClient.ChannelFollow += OnChannelFollow;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> async Task StartAsync(CancellationToken cancellationToken)</div>
<div class="line">        {</div>
<div class="line">            await _eventSubWebsocketClient.ConnectAsync();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">public</span> async Task StopAsync(CancellationToken cancellationToken)</div>
<div class="line">        {</div>
<div class="line">            await _eventSubWebsocketClient.DisconnectAsync();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnWebsocketConnected(<span class="keywordtype">object</span>? sender, <a class="code hl_class" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_websocket_connected_args.html">WebsocketConnectedArgs</a> e)</div>
<div class="line">        {</div>
<div class="line">            _logger.LogInformation($<span class="stringliteral">&quot;Websocket {_eventSubWebsocketClient.SessionId} connected!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!e.<a class="code hl_property" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_websocket_connected_args.html#a3be6b7db6f4ff482ad6edbb12f6bc728">IsRequestedReconnect</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// subscribe to topics</span></div>
<div class="line">            }</div>
<div class="line">         }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> async <span class="keywordtype">void</span> OnWebsocketDisconnected(<span class="keywordtype">object</span>? sender, EventArgs e)</div>
<div class="line">        {</div>
<div class="line">            _logger.LogError($<span class="stringliteral">&quot;Websocket {_eventSubWebsocketClient.SessionId} disconnected!&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Don&#39;t do this in production. You should implement a better reconnect strategy with exponential backoff</span></div>
<div class="line">            <span class="keywordflow">while</span> (!await _eventSubWebsocketClient.ReconnectAsync())</div>
<div class="line">            {</div>
<div class="line">                _logger.LogError(<span class="stringliteral">&quot;Websocket reconnect failed!&quot;</span>);</div>
<div class="line">                await Task.Delay(1000);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnWebsocketReconnected(<span class="keywordtype">object</span>? sender, EventArgs e)</div>
<div class="line">        {</div>
<div class="line">            _logger.LogWarning($<span class="stringliteral">&quot;Websocket {_eventSubWebsocketClient.SessionId} reconnected&quot;</span>);</div>
<div class="line">        }      </div>
<div class="line">      </div>
<div class="line">         <span class="keyword">private</span> <span class="keywordtype">void</span> OnErrorOccurred(<span class="keywordtype">object</span>? sender, <a class="code hl_class" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_error_occured_args.html">ErrorOccuredArgs</a> e)</div>
<div class="line">        {</div>
<div class="line">            _logger.LogError($<span class="stringliteral">&quot;Websocket {_eventSubWebsocketClient.SessionId} - Error occurred!&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">private</span> <span class="keywordtype">void</span> OnChannelFollow(<span class="keywordtype">object</span>? sender, <a class="code hl_class" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_channel_1_1_channel_follow_args.html">ChannelFollowArgs</a> e)</div>
<div class="line">        {</div>
<div class="line">            var eventData = e.<a class="code hl_property" href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_twitch_lib_event_sub_event_args.html#ab043ee2713fc8a04d8dbd5da6fd08077">Notification</a>.Payload.Event;</div>
<div class="line">            _logger.LogInformation($<span class="stringliteral">&quot;{eventData.UserName} followed {eventData.BroadcasterUserName} at {eventData.FollowedAt}&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_channel_1_1_channel_follow_args_html"><div class="ttname"><a href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_channel_1_1_channel_follow_args.html">TwitchLib.EventSub.Websockets.Core.EventArgs.Channel.ChannelFollowArgs</a></div><div class="ttdef"><b>Definition:</b> ChannelFollowArgs.cs:7</div></div>
<div class="ttc" id="aclass_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_error_occured_args_html"><div class="ttname"><a href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_error_occured_args.html">TwitchLib.EventSub.Websockets.Core.EventArgs.ErrorOccuredArgs</a></div><div class="ttdef"><b>Definition:</b> ErrorOccuredArgs.cs:6</div></div>
<div class="ttc" id="aclass_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_twitch_lib_event_sub_event_args_html_ab043ee2713fc8a04d8dbd5da6fd08077"><div class="ttname"><a href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_twitch_lib_event_sub_event_args.html#ab043ee2713fc8a04d8dbd5da6fd08077">TwitchLib.EventSub.Websockets.Core.EventArgs.TwitchLibEventSubEventArgs.Notification</a></div><div class="ttdeci">T Notification</div><div class="ttdef"><b>Definition:</b> TwitchLibEventSubEventArgs.cs:5</div></div>
<div class="ttc" id="aclass_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_websocket_connected_args_html"><div class="ttname"><a href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_websocket_connected_args.html">TwitchLib.EventSub.Websockets.Core.EventArgs.WebsocketConnectedArgs</a></div><div class="ttdef"><b>Definition:</b> WebsocketConnectedArgs.cs:4</div></div>
<div class="ttc" id="aclass_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_websocket_connected_args_html_a3be6b7db6f4ff482ad6edbb12f6bc728"><div class="ttname"><a href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_websocket_connected_args.html#a3be6b7db6f4ff482ad6edbb12f6bc728">TwitchLib.EventSub.Websockets.Core.EventArgs.WebsocketConnectedArgs.IsRequestedReconnect</a></div><div class="ttdeci">bool IsRequestedReconnect</div><div class="ttdef"><b>Definition:</b> WebsocketConnectedArgs.cs:5</div></div>
<div class="ttc" id="aclass_twitch_lib_1_1_event_sub_1_1_websockets_1_1_event_sub_websocket_client_html"><div class="ttname"><a href="class_twitch_lib_1_1_event_sub_1_1_websockets_1_1_event_sub_websocket_client.html">TwitchLib.EventSub.Websockets.EventSubWebsocketClient</a></div><div class="ttdoc">EventSubWebsocketClient used to subscribe to EventSub notifications via Websockets</div><div class="ttdef"><b>Definition:</b> EventSubWebsocketClient.cs:24</div></div>
<div class="ttc" id="anamespace_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_channel_html"><div class="ttname"><a href="namespace_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_1_1_channel.html">TwitchLib.EventSub.Websockets.Core.EventArgs.Channel</a></div><div class="ttdef"><b>Definition:</b> ChannelBanArgs.cs:5</div></div>
<div class="ttc" id="anamespace_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args_html"><div class="ttname"><a href="namespace_twitch_lib_1_1_event_sub_1_1_websockets_1_1_core_1_1_event_args.html">TwitchLib.EventSub.Websockets.Core.EventArgs</a></div><div class="ttdef"><b>Definition:</b> ChannelBanArgs.cs:5</div></div>
</div><!-- fragment --><p >Alternatively you can also just clone the examples:</p><ul>
<li>.NET Framework 4.8 <a href="https://github.com/TwitchLib/TwitchLib.EventSub.Websockets/tree/main/TwitchLib.EventSub.Websockets.Example.NetStandard">https://github.com/TwitchLib/TwitchLib.EventSub.Websockets/tree/main/TwitchLib.EventSub.Websockets.Example.NetStandard</a></li>
<li>.NET 6 -&gt; <a href="https://github.com/TwitchLib/TwitchLib.EventSub.Websockets/tree/main/TwitchLib.EventSub.Websockets.Example">https://github.com/TwitchLib/TwitchLib.EventSub.Websockets/tree/main/TwitchLib.EventSub.Websockets.Example</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
